# LLM功能使用指南

## 概述

智能排课系统共集成了5个LLM功能，分别是：

1. **智能助手** (IntelligentAssistant)
2. **需求分析器** (RequirementAnalyzer)
3. **冲突解决** (ConflictResolution)
4. **参数优化** (ParameterOptimization)
5. **调度解释** (ScheduleExplanation)

## 准备工作

要使所有LLM功能正常工作，需要确保以下条件满足：

1. 已在`.env`文件中设置有效的OpenAI API密钥
2. 后端Python FastAPI服务正在运行
3. 前端应用程序已启动

### 启动后端API服务

```bash
# 切换到后端目录
cd SmartSchedulingSystem.API/scheduling-client/src/python_backend

# 启动API服务
python run_api.py
```

服务将在`http://localhost:8000`上运行，提供所有必需的API端点。

### 启动前端应用

```bash
# 切换到前端目录
cd SmartSchedulingSystem.API/scheduling-client

# 安装依赖（如果尚未安装）
npm install

# 启动应用
npm start
```

前端应用将在`http://localhost:3000`上运行。

## 功能测试指南

### 1. 智能助手 (IntelligentAssistant)

- 点击界面右下角的智能助手图标打开聊天窗口
- 输入与调度相关的问题，例如：
  - "为什么计算机科学课程安排在B楼？"
  - "如何优化当前的排课方案？"
  - "本学期有多少课程冲突？"
  - "分析一下当前的教室使用率"

### 2. 需求分析器 (RequirementAnalyzer)

- 在课程排课表单页面，找到"调度需求分析器"组件
- 在文本框中输入自然语言描述的调度需求，例如：
  - "我们需要安排一门高级数学课程，每周两次，每次2小时。张教授只在周一和周三上午有空。这个班大约有120名学生，需要有投影设备的教室。另外，这门课最好不要与物理课在同一天安排，因为对学生来说负担太重。"
- 点击"分析约束条件"按钮
- 系统将自动提取显式和隐式约束条件
- 可以点击"添加所有约束到系统"按钮将分析结果添加到排课系统中

### 3. 冲突解决 (ConflictResolution)

- 在调度结果页面，系统会显示检测到的冲突
- 对于每个冲突，点击"智能分析"按钮
- 系统将分析冲突的根本原因并提供多个解决方案
- 查看每个解决方案的兼容性评分和潜在影响
- 选择最适合的解决方案并点击"应用此解决方案"

### 4. 参数优化 (ParameterOptimization)

- 在系统设置或高级选项页面，找到"智能参数优化"按钮
- 点击该按钮，系统将分析当前参数设置和历史数据（如果可用）
- 查看建议的参数调整和新参数建议
- 可以选择要应用的具体建议
- 点击"应用所选建议"按钮以更新系统参数

### 5. 调度解释 (ScheduleExplanation)

- 在调度结果页面，每个调度项目旁边都有一个问号图标
- 点击该图标以查看为什么系统做出了特定的调度决策
- 系统将解释选择特定时间、教室和教师的原因
- 还将显示系统考虑过但未选择的替代方案及其被拒绝的原因

## 常见问题排查

1. **API连接错误**
   - 确保Python后端服务正在运行
   - 检查控制台是否有CORS错误，可能需要在后端添加允许的源

2. **解析错误**
   - 检查Python后端控制台日志，查看API返回的原始JSON格式
   - API会自动使用模拟数据作为后备，因此即使LLM响应解析失败，系统仍会显示合理的结果

3. **OpenAI API限制**
   - 如果遇到频率限制错误，可以尝试减少请求频率或升级API计划

4. **模型规模限制**
   - LLM API使用的是gpt-3.5-turbo模型，如需更复杂的分析，可以考虑在`llm_api.py`中升级到更强大的模型 